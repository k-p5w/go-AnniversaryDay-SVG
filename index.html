<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>記念日/誕生日カウンター SVGプレビュー</title>
    <!-- Tailwind CSS CDNを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interフォントを優先し、日本語フォントを併用 */
        body {
            font-family: 'Inter', 'Meiryo', 'Hiragino Kaku Gothic ProN', sans-serif;
            min-height: 100vh;
            background-color: #1f2937; /* Dark background */
        }
        /* カスタムアラート用のスタイル */
        .alert-box {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            transition: opacity 0.3s ease-in-out;
        }
        /* SVGプレビューのコンテナ: <img>タグを使用するため、調整 */
        .svg-container img {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem; /* rounded-xl と同じ */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#4f46e5',
                    }
                }
            }
        }
        
        // 外部APIのベースURLを定義
        const BASE_API_URL = "https://go-anniversary-day-svg.vercel.app/api";
    </script>
</head>
<body class="text-gray-100 flex flex-col items-center p-4 sm:p-8">

    <div id="alertContainer"></div>

    <div class="w-full max-w-4xl bg-gray-800 p-6 rounded-xl shadow-2xl">
        <h1 class="text-3xl font-extrabold mb-6 text-center text-primary">記念日/誕生日カウンター</h1>

        <!-- プレビューエリア -->
        <div class="mb-8 p-4 bg-gray-900 rounded-lg flex justify-center items-center min-h-[150px]">
            <div id="svgPreview" class="svg-container w-full">
                <p class="text-gray-500 text-center">生成ボタンを押すとSVGが表示されます。</p>
            </div>
        </div>
        
        <!-- URL表示エリア (デバッグ用) -->
        <div class="mb-6">
            <label for="apiUrlDisplay" class="block text-sm font-medium mb-1">生成されたAPI URL (デバッグ用)</label>
            <input type="text" id="apiUrlDisplay" readonly
                   class="w-full p-2 text-xs border border-gray-600 rounded-lg bg-gray-700 text-gray-400 select-all">
        </div>

        <!-- コントロールパネル -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <!-- 左カラム: 基本設定 -->
            <div class="space-y-4">
                <h2 class="text-xl font-bold border-b border-gray-700 pb-2 mb-4">基本設定</h2>
                
                <!-- 1. 日付入力 -->
                <div>
                    <label for="dateInput" class="block text-sm font-medium mb-1">日付 (誕生日/開始日)</label>
                    <input type="date" id="dateInput" value="2000-01-01"
                           class="w-full p-2 border border-gray-600 rounded-lg bg-gray-700 text-gray-200 focus:ring-primary focus:border-primary">
                </div>

                <!-- 2. 種別選択 (Birthday/Anniversary) -->
                <div>
                    <label class="block text-sm font-medium mb-1">種別</label>
                    <div class="flex space-x-4 p-2 bg-gray-700 rounded-lg">
                        <label class="inline-flex items-center">
                            <input type="radio" name="typeSelect" value="birthday" checked
                                   class="form-radio text-primary border-gray-600 bg-gray-800 focus:ring-primary">
                            <span class="ml-2">誕生日</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="typeSelect" value="anniversaryday"
                                   class="form-radio text-primary border-gray-600 bg-gray-800 focus:ring-primary">
                            <span class="ml-2">記念日</span>
                        </label>
                    </div>
                </div>

                <!-- 3. 表示名/ロゴ (Goコードで dispname に変更) -->
                <div>
                    <label for="dispNameInput" class="block text-sm font-medium mb-1">表示名 (dispname)</label>
                    <input type="text" id="dispNameInput" placeholder="例: My App Name" value=""
                           class="w-full p-2 border border-gray-600 rounded-lg bg-gray-700 text-gray-200 focus:ring-primary focus:border-primary">
                </div>
            </div>

            <!-- 右カラム: スタイル設定 -->
            <div class="space-y-4">
                <h2 class="text-xl font-bold border-b border-gray-700 pb-2 mb-4">スタイル設定</h2>

                <!-- 4. 背景色 -->
                <div>
                    <label for="colorInput" class="block text-sm font-medium mb-1">背景色 (color)</label>
                    <input type="color" id="colorInput" value="#1f2937"
                           class="w-full h-10 p-1 border border-gray-600 rounded-lg bg-gray-700">
                </div>
            </div>
        </div>
        
        <!-- ボタン -->
        <div class="mt-8">
            <button onclick="generateCard()"
                    class="w-full bg-primary hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-xl transition duration-200 shadow-lg shadow-indigo-500/50 transform hover:scale-[1.01]">
                SVG生成
            </button>
        </div>
    </div>

    <script>
        const svgPreview = document.getElementById('svgPreview');
        const alertContainer = document.getElementById('alertContainer');
        const apiUrlDisplay = document.getElementById('apiUrlDisplay');

        /**
         * カスタムアラートメッセージを表示する (alert()の代わり)
         */
        function alertMessage(message, type = 'info') {
            const id = 'alert-' + Date.now();
            const colorClass = type === 'warning' ? 'bg-yellow-500' : 'bg-green-500';
            const alertHtml = `
                <div id="${id}" class="alert-box p-4 rounded-lg shadow-xl text-sm font-semibold ${colorClass} text-white opacity-0 transform translate-x-10">
                    ${message}
                </div>
            `;
            alertContainer.innerHTML = alertHtml;
            
            // フェードイン
            setTimeout(() => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.remove('opacity-0', 'translate-x-10');
                    element.classList.add('opacity-100', 'translate-x-0');
                }
            }, 50);

            // フェードアウト
            setTimeout(() => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.remove('opacity-100', 'translate-x-0');
                    element.classList.add('opacity-0', 'translate-x-10');
                    setTimeout(() => element.remove(), 300); // アニメーション後に削除
                }
            }, 3000);
        }

        /**
         * カード生成のためのURLを構築し、<img>タグに埋め込む
         */
        function generateCard() {
            const dateInput = document.getElementById('dateInput').value;
            const typeSelect = document.querySelector('input[name="typeSelect"]:checked').value;
            const dispName = document.getElementById('dispNameInput').value;
            const color = document.getElementById('colorInput').value.substring(1); // #を削除

            if (!dateInput) {
                alertMessage('日付を入力してください。', 'warning');
                return;
            }

            const datePart = dateInput.replace(/-/g, ''); // YYYYMMDD
            
            let params = [];

            // 1. color (最優先で先頭に配置)
            if (color) {
                const colorValue = color.length === 3 || color.length === 6 ? color : '';
                if (colorValue) {
                    params.push(`color=${colorValue}`);
                }
            }

            // 2. dispname (日付の前に配置)
            if (dispName) {
                params.push(`dispname=${encodeURIComponent(dispName)}`);
            }

            // 3. birthday / anniversaryday (最後に配置)
            if (typeSelect === 'birthday') {
                params.push(`birthday=${datePart}`); 
            } else {
                params.push(`anniversaryday=${datePart}`);
            }
            
            // パラメーターを結合し、URLを構築
            let url = BASE_API_URL + '?' + params.join('&');
            
            // 4. 最後に .svg を付加
            url += '.svg';

            // デバッグ用にURLを表示
            apiUrlDisplay.value = url;
            
            svgPreview.innerHTML = `
                <img src="${url}" 
                     alt="記念日カウンターSVGカード" 
                     class="rounded-xl mx-auto w-full max-w-sm" 
                     onerror="this.onerror=null; this.alt='SVGの読み込みに失敗しました。APIエラーの可能性があります。'; this.style.opacity='0.5'; this.style.border='3px dashed red';"
                />
            `;
            
            alertMessage('SVG URLを img タグに設定しました。');
        }

        // 初期ロード時に一度生成を試みる
        window.onload = () => {
             generateCard();
        };

    </script>
</body>
</html>
